## Локальное развертывание
### Composer
```bash
$ composer install -o
```
### Настройка окружения:
Скопировать себе файл .env, заполнить данные интеграции и аккаунта AmoCRM (см. "Настройка интеграции с AmoCRM"), а так же хост и данные доступа к БД MySQL
```bash
$ cp .env.dist .env
```
### Базовые миграции БД:
Выполнить миграции для создания таблиц:
```bash
$ vendor/bin/phpmig up 20230801153319 && vendor/bin/phpmig up 20230801154613
&& vendor/bin/phpmig up 20231114071629 && vendor/bin/phpmig up 20231118133928 
&& vendor/bin/phpmig up 20231120122514
```

 ### Запуск локального сервера:
 
 ```bash
 $ composer serve
 ```

 ### Локальная настройка для cron:
 Скопировать себе файл .cron, записать в него путь до репозитория
```bash
$ cp .cron.dist .cron
```
Добавить в cron:
```bash
$ crontab ./crontab
```

## Настройка интеграции с amoCRM

Создать внешнюю интеграцию, с ссылкой на общедоступный хост (например, через ngrok) на эндпойнт /auth. После создания интеграции будут получены ID интеграции и секретный ключ, вместе с указанной ссылкой поместить их в .env-файл.

Для получения хуков по созданию сделок добавить в своем аккаунте amoCRM вебхук на событие создания сдекли на эндпойнт /webhooks/lead/add

Основные эндпойнты: 

/leads - список записанных сделок

/leads/sum - сумма записанных сделок

Для обоих эндпойнтов доступна фильтрация по полям "статус" и "ответственный", фильтр в виде GET-параметра
Пример ссылки с фильтрацией:
/leads?filter[status]=142&filter[responsible][0]=8643751&filter[responsible][1]=9919770

Присутствует валидация фильтруемых полей, при передачи несуществующих ID статуса или ответственного будет выведена соответствующая ошибка



